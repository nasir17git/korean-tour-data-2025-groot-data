name: Daily Tourism Data Sync

on:
  schedule:
    # 매일 새벽 2시 (KST = UTC+9)
    - cron: '0 17 * * *'
  
  # 수동 실행 가능
  workflow_dispatch:
    inputs:
      force_sync:
        description: 'Force sync even if recent sync exists'
        required: false
        default: 'false'
        type: boolean

jobs:
  run:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - a: "1"
            b: "2"
            c: "F"
            d: "T"
          - a: "2"
            b: "5"
            c: "F"
            d: "T"
          - a: "3"
            b: "1"
            c: "F"
            d: "T"
    steps:
      - name: Run container (${{ matrix.a }} ${{ matrix.b }} ${{ matrix.c }} ${{ matrix.d }})
        env:
          SUPABASE_BASE_URL: ${{ secrets.SUPABASE_BASE_URL }}
          SUPABASE_API_KEY: ${{ secrets.SUPABASE_API_KEY }}
          DATA_KEY_ENCODING: ${{ secrets.DATA_KEY_ENCODING }}
          DATA_KEY_DECODING: ${{ secrets.DATA_KEY_DECODING }}
        run: |
          docker pull nasir17/korean-tour-app-crawler:latest
          docker run --rm \
            -e SUPABASE_BASE_URL="$SUPABASE_BASE_URL" \
            -e SUPABASE_API_KEY="$SUPABASE_API_KEY" \
            -e DATA_KEY_ENCODING="$DATA_KEY_ENCODING" \
            -e DATA_KEY_DECODING="$DATA_KEY_DECODING" \
            nasir17/korean-tour-app-crawler:latest \
            python main.py "${{ matrix.a }}" "${{ matrix.b }}" "${{ matrix.c }}" "${{ matrix.d }}"


